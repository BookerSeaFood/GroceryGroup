<!DOCTYPE html>

<html>
	<head>
		<title>myBasket</title>

		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

		<link rel="stylesheet" href="js/lib/jQueryMobile/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="css/my-lists.css">

		<script src="js/lib/jQuery/jquery-1.12.2.min.js"></script>
		<script src="js/lib/jQueryMobile/jquery.mobile-1.4.5.min.js"></script>

		<script src="js/classes/mockgrocerylist.js"></script>
		<script src="js/classes/mocklistlist.js"></script>

		<script>
			// Initialize all namespaces and global variables

			if (mb == null || typeof(mb) != "object"){
				 var mb = new Object();
			}

			if (mb.glob == null || typeof(mb.glob) != "object"){
				mb.glob = new Object();
			}

			$(document).bind("mobileinit",function() {
				$.mobile.changePage.defaults.changeHash = false;
				$.mobile.hashListeningEnabled = false;
				$.mobile.pushStateEnabled = false;
			});

			// Need to implement a lot here
			mb.glob.lists = new mb.MockListList();
			mb.glob.lists.add(new mb.MockGroceryList("Mock List"));
			mb.glob.lists.add(new mb.MockGroceryList("Mock List 2"));
			mb.glob.selectedList = "Mock List";

			mb.glob.curList = mb.MockListList.listByName(mb.glob.lists, mb.glob.selectedList);
			mb.glob.curList.load(mb.glob.selectedList);

			mb.glob.curItemId = -1;
		</script>
	</head>

	<body>
		<!--
		-->
		<div data-role="page" id="listOfLists">
			<div data-role="header" class="listListTitle">
				<a href="#addListsPage" data-icon="plus">Create a List</a>
				<h3>My Lists</h3>
			</div>
			<div class="allLists">
				<!-- -->
			</div>
		</div>

		<!--
		View List
			*display list name
			*display items in list
			*option to add item and reroute to add item page
		 -->
		<div data-role="page" id="listPage">
			<div data-role="header" class="listTitle">
				<!-- -->
			</div>
			<div class="list">
				<!-- -->
			</div>
		</div>

		<!--
		Add item Page:
			*enter name and number for item and adds item to list
			*return to view list page
			*select cancel: return to listPage
		-->
		<div data-role="page" id="addItemPage">
			<div data-role="header">
				<h2>Add Item</h2>
				<a href="#listPage" data-icon="delete" class="cancelItem">Cancel</a>

			</div>
			<div style="padding16px;">
				Item : <input class="nameInput" type="textbox" value="" placeholder="Item Name"/></input>
			</div>

			<div style="padding16px;">
				Quantity : <input class="ctInput" type="number" value="" placeholder="Amount"/></input>
			</div>

			<a href="#listPage"><button class="enterItem" id="Enter">Enter Item</button></a>

		</div>


		<!--
		 -->
		<div data-role="page" id="editItemPage">
			<div data-role="header">
				<h2>Edit Item</h2>
				<a href="#listPage" data-icon="delete" class="cancelItem">Cancel</a>
			</div>
			<div style="padding16px;">
				Item : <input class="editItemName" type="textbox" value="" placeholder="Item Name"/></input>
			</div>

			<div style="padding16px;">
				Quantity : <input class="editItemCt" type="number" value="" placeholder="Amount"/></input>
			</div>

			<a  href="#listPage"><button class="submitEdit" id="EditItem">Save</button></a>
		</div>
	</body>
	<script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript">
		// Still need a lot to be implemented for this to work, but this is
		//  the basic idea

		// Update the view
		function updateGroceryListTitle() {
			$('.listTitle').empty();
			$('.listTitle').append('<a href="#addItemPage" data-icon="plus">Add Item</a>');
			$('.listTitle').append('<a href="#listOfLists" data-icon="delete">Return to Lists</a>');
			$('.listTitle').append('<h3>' + mb.glob.selectedList + '</h3>');
		}

		function updateGroceryLists() {
			var odd = false

			$('.allLists').empty();

			for (var i = 0; i < mb.glob.lists.len(); i++){
				var bgClass = 'oddListItem';
				if (!odd) {
					bgClass = 'evenListItem';
				}

				var list = mb.glob.lists.get(i);
				var el = $('<div class="listListItem ' + bgClass + '" id="' + list.name + '">' + mb.listToHtml(list) + '</div>');
				$('.allLists').append(el);

				$(el).click(function(){
					mb.glob.selectedList = this.id.toString();
					mb.glob.curList = mb.MockListList.listByName(mb.glob.lists, mb.glob.selectedList);
					updateGroceryListItems();
					updateGroceryListTitle();
				});

				odd = !odd;
			}
		}

		function updateGroceryListItems() {
			var odd = false

			$('.list').empty();

			for (var i = 0; i < mb.glob.curList.len(); i++){
				var bgClass = 'oddListItem';
				if (!odd) {
					bgClass = 'evenListItem';
				}

				var item = mb.glob.curList.get(i);
				var el = $('<div class="listItem ' + bgClass + '" id="' + item.id + '">' + mb.listItemToHtml(item) + '</div>');
				$('.list').append(el);

				$(el).click(function(){
					mb.glob.curItemId = this.id.toString();
					setupEditItem()
				});

				odd = !odd;
			}
		}

		function update() {
			updateGroceryLists();
			updateGroceryListTitle();
			updateGroceryListItems();
		}

		// Clear the input fields
		function clearAddItemInput() {
			$('.nameInput').val('');
			$('.ctInput').val('');
		}

		function clearEditItemInputs() {
			$('.editItemName').val('');
			$('.editItemCt').val('');
		}

		function clearInput() {
			clearAddItemInput();
			clearEditItemInputs();
		}

		// List adding functionality
		function addList() {
			var name = $('.listNameInput').val();

			if (!name){
				return;
			}

			mb.glob.lists.add(new mb.MockGroceryList(name));

			updateGroceryListItems();
			clearAddItemInput();
		}

		// Item adding functionality
		function addItem() {
			var item = new Object();
			item.name = $('.nameInput').val();
			item.ct = $('.ctInput').val();
			item.id = mb.glob.curList.len()

			if (!item.name || !item.ct){
				return;
			}

			mb.glob.curList.addItem(mb.glob.curList, item);

			updateGroceryListItems();
			clearAddItemInput();
		}

		// Item editing functionality
		function setupEditItem() {
			var item = mb.glob.curList.get(mb.glob.curItemId);
			$('.editItemName').val(item.name);
			$('.editItemCt').val(item.ct);
		}

		function doEditItem() {
			var item = new Object();
			item.name = $('.editItemName').val();
			item.ct = $('.editItemCt').val();

			mb.glob.curList.edit(mb.glob.curList, mb.glob.curItemId, item);

			updateGroceryListItems();
			clearEditItemInputs();
		}

		// Set click events
		$('.enterItem').click(addItem);
		$('.cancelItem').click(clearInput);
		$('.submitEdit').click(doEditItem);

		// Update the view
		update();

	</script>
</html>
