<!DOCTYPE html>

<html>
	<head>
		<title>myBasket</title>

		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />

		<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, target-densitydpi=device-dpi" />

		<link rel="stylesheet" href="js/lib/jQueryMobile/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="css/my-lists.css">

		<script src="js/lib/jQuery/jquery-1.12.2.min.js"></script>
		<script src="js/lib/jQueryMobile/jquery.mobile-1.4.5.min.js"></script>

		<!-- Our modules -->
		<script src="js/classes/mockgrocerylist.js"></script>
		<script src="js/classes/mocklistlist.js"></script>

		<!-- Initialize all namespaces and global variables -->
		<script>
			if (mb == null || typeof(mb) != "object"){
				 var mb = new Object();
			}

			if (mb.glob == null || typeof(mb.glob) != "object"){
				mb.glob = new Object();
			}

			$(document).bind("mobileinit",function() {
				$.mobile.changePage.defaults.changeHash = false;
				$.mobile.hashListeningEnabled = false;
				$.mobile.pushStateEnabled = false;
			});

			// Need to implement a lot here
			mb.glob.lists = new mb.MockListList();
			//mb.glob.lists.add(new mb.MockGroceryList("Mock List"));
			//mb.glob.lists.add(new mb.MockGroceryList("Mock List 2"));
			mb.glob.selectedList = "";

			mb.glob.curList = None;//mb.MockListList.listByName(mb.glob.lists, mb.glob.selectedList);
			//mb.glob.curList.load(mb.glob.selectedList);

			mb.glob.curItemId = -1;
		</script>
	</head>

    <!--
       Data role for all APP pages:
        *all pages should contain title of page and a home button (icon or app title)
        *all pages off should have opton to return to previous page
            except ListofList and StartPage      
    -->

	<body>
		<!--Listof Lists (also Home page once logged in)
            *display all the users lists
            *option to access profilePage
            *option to create list
            *option to edit a list by clicking on it 
		-->
		<div data-role="page" id="listOfLists">
			<div data-role="header" class="listListTitle">
				<a href="#addListsPage" data-icon="plus">Create a List</a>
				<h3>My Lists</h3>
			</div>
			<div class="allLists">
				<!-- -->
			</div>
		</div>

        <!--Start Page: first pge to show up if not logged on
            *display app name and logo
            *option to log in
            *option to register    
         -->
        <div data-role="page" id="startPage" >

        </div>

        <!--LogIn Page
            *display button to go back
            *prompt for username, password, and email
            *display register button
                -check if username or email had been used before
                -if so: prompt for userName or passowrd to be changed
                -if not: register user and direct to home page
             -->
        <div data-role="page" id="logInPage">

        </div>

        <!--RegisterPage
            *display button to go back
            *prompt for username and password
            *display login button
             -check if username and password exist
              -if not prompt for different username or password
               -else : login and direct to homepage 
        -->
        <div data-role="page" id="registerPage">

        </div>


		<!--Add List Page
            *option to cancle
            *option to add list and reroute to the ViewListpage for the new list
		-->
		<div data-role="page" id="addListsPage">
			<div data-role="header">
				<h2>Add New List</h2>
				<a href="#listOfLists" data-icon="delete" class="cancelNewList">Cancel</a>
			</div>

			<div style="padding16px;">
				Name : <input class="listNameInput" type="textbox" value="" placeholder="List Name"/></input>
			</div>

			<a href="#listOfLists"><button class="enterList" id="EnterList">Create List</button></a>
		</div>

		<!--
		View List
			*display list name
			*display items in list
			*option to add item and reroute to add item page
            *option to edit items by clickign them and rerouting to 
                edit item page
            *option to return to ListofLists
            *might: option to checkoff*delete) item without accessing edit item
		 -->
		<div data-role="page" id="listPage">
			<div data-role="header" class="listTitle">
				<!-- -->
			</div>
			<div class="list">
				<!-- -->
			</div>
		</div>

        <!--LeaveListPage
            *check if other users have access to this page
            *if only Use: option to delete list and redirect to listof lists
            *if other user: option to leave list and redirect to listofLists
        -->
        <div data-role="page" id="leaveListPage">

        </div>

        <!--
        -->
        <div data-role="page" id="shareListPage">

        </div>

        <!--
        Profile Page(also contains contacts)
                *
        -->
        <div data-role="page" id="ProfilePage">

        </div>

        <!--
        -->
        <div data-role="page" id="deleteProfilePage">

        </div>

        <!--
        -->
        <div data-role="page" id="addContactPage">

        </div>

        <!--
        -->
        <div data-role="page" id="editContactPage">

        </div>

		<!--
		Add item Page:
			*enter name and number for item and adds item to list
			*return to view list page
			*select cancel: return to listPage
		-->
		<div data-role="page" id="addItemPage">
			<div data-role="header">
				<h2>Add Item</h2>
				<a href="#listPage" data-icon="delete" class="cancelItem">Cancel</a>
			</div>

			<div style="padding16px;">
				Item : <input class="nameInput" type="textbox" value="" placeholder="Item Name"/></input>
			</div>

			<div style="padding16px;">
				Quantity : <input class="ctInput" type="number" value="" placeholder="Amount"/></input>
			</div>

			<a href="#listPage"><button class="enterItem" id="Enter">Enter Item</button></a>
		</div>

		<!--
		 -->
		<div data-role="page" id="editItemPage">
			<div data-role="header">
				<h2>Edit Item</h2>
				<a href="#listPage" data-icon="delete" class="cancelItem">Cancel</a>
			</div>

			<div style="padding16px;">
				Item : <input class="editItemName" type="textbox" value="" placeholder="Item Name"/></input>
			</div>

			<div style="padding16px;">
				Quantity : <input class="editItemCt" type="number" value="" placeholder="Amount"/></input>
			</div>

			<a  href="#listPage"><button class="submitEdit" id="EditItem">Save</button></a>
		</div>

        <!--
        -->
        <div data-role="page" id="">

        </div>
	</body>


	<!-- Required library to build with phonegap -->
	<script type="text/javascript" src="cordova.js"></script>

	<!-- Controllers -->
	<script type="text/javascript">
		// Still need a lot to be implemented for this to work, but this is
		//  the basic idea

		// Update the view
		function updateGroceryListTitle() {
			$('.listTitle').empty();
			$('.listTitle').append('<a role="button" data-role="button" class="ui-link ui-btn-left ui-btn ui-icon-plus ui-btn-icon-left ui-shadow ui-corner-all" href="#addItemPage" data-icon="plus">Add Item</a>');
			$('.listTitle').append('<a role="button" data-role="button" class="ui-link ui-btn-right ui-btn ui-icon-delete ui-btn-icon-left ui-shadow ui-corner-all" href="#listOfLists" data-icon="delete">Return to Lists</a>');
			$('.listTitle').append('<h3>' + mb.glob.selectedList + '</h3>');
		}

		function updateGroceryLists() {
			var odd = false

			$('.allLists').empty();

			for (var i = 0; i < mb.glob.lists.len(); i++){
				var bgClass = 'oddListItem';
				if (!odd) {
					bgClass = 'evenListItem';
				}

				var list = mb.glob.lists.get(i);
				var el = $('<div class="listListItem ' + bgClass + '" id="' + list.name + '">' + mb.listToHtml(list) + '</div>');
				$('.allLists').append(el);

				$(el).click(function(){
					mb.glob.selectedList = this.id.toString();
					mb.glob.curList = mb.MockListList.listByName(mb.glob.lists, mb.glob.selectedList);
					updateGroceryListItems();
					updateGroceryListTitle();
				});

				odd = !odd;
			}
		}

		function updateGroceryListItems() {
			var odd = false

			$('.list').empty();

			for (var i = 0; i < mb.glob.curList.len(); i++){
				var bgClass = 'oddListItem';
				if (!odd) {
					bgClass = 'evenListItem';
				}

				var item = mb.glob.curList.get(i);
				var el = $('<div class="listItem ' + bgClass + '" id="' + item.id + '">' + mb.listItemToHtml(item) + '</div>');
				$('.list').append(el);

				$(el).click(function(){
					mb.glob.curItemId = this.id.toString();
					setupEditItem()
				});

				odd = !odd;
			}
		}

		function update() {
			updateGroceryLists();
			updateGroceryListTitle();
			updateGroceryListItems();
		}

		// Clear the input fields
		function clearAddListInput() {
			$('.listNameInput').val('');
		}

		function clearAddItemInput() {
			$('.nameInput').val('');
			$('.ctInput').val('');
		}

		function clearEditItemInputs() {
			$('.editItemName').val('');
			$('.editItemCt').val('');
		}

		function clearInput() {
			clearAddListInput();
			clearAddItemInput();
			clearEditItemInputs();
		}

		// List adding functionality
		function addList() {
			var name = $('.listNameInput').val();

			if (!name){
				return;
			}

			mb.glob.lists.add(new mb.MockGroceryList(name));

			updateGroceryLists();
			clearAddListInput();
		}

		// Item adding functionality
		function addItem() {
			var item = new Object();
			item.name = $('.nameInput').val();
			item.ct = $('.ctInput').val();
			item.id = mb.glob.curList.len()

			if (!item.name || !item.ct){
				return;
			}

			mb.glob.curList.addItem(mb.glob.curList, item);

			updateGroceryListItems();
			clearAddItemInput();
		}

		// Item editing functionality
		function setupEditItem() {
			var item = mb.glob.curList.get(mb.glob.curItemId);
			$('.editItemName').val(item.name);
			$('.editItemCt').val(item.ct);
		}

		function doEditItem() {
			var item = new Object();
			item.name = $('.editItemName').val();
			item.ct = $('.editItemCt').val();

			mb.glob.curList.edit(mb.glob.curList, mb.glob.curItemId, item);

			updateGroceryListItems();
			clearEditItemInputs();
		}

		// Set click events
		$('.enterList').click(addList);
		$('.cancelNewList').click(clearInput);
		$('.enterItem').click(addItem);
		$('.cancelItem').click(clearInput);
		$('.submitEdit').click(doEditItem);

		// Update the view
		update();

	</script>
</html>
